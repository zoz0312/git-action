name: Create release branch and PR

on:
  workflow_dispatch:
    inputs:
      tag:
        description: '릴리즈 태그 (예: v1.2.3)'
        required: true
        type: string

jobs:
  create-release-pr:
    runs-on: ubuntu-latest

    permissions:
      contents: write        # 브랜치 푸시 권한
      pull-requests: write   # PR 생성 권한

    env:
      TAG: ${{ github.event.inputs.tag }}
      BRANCH: release/${{ github.event.inputs.tag }}

    steps:
      - name: Checkout develop branch
        uses: actions/checkout@v4
        with:
          ref: develop
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"

      - name: Create release branch from develop
        run: |
          git checkout -b "$BRANCH"
          git push origin "$BRANCH"

      - name: Create Pull Request (develop → ${{ env.BRANCH }})
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: ${{ env.BRANCH }}
          head: develop
          title: "chore(release): ${{ env.TAG }} 준비"
          body: |
            자동 생성된 PR입니다.

            - 릴리즈 태그: `${{ env.TAG }}`
            - 대상 브랜치: `${{ env.BRANCH }}`
          draft: false
