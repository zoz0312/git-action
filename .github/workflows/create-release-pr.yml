name: Create release branch and PR

on:
  workflow_dispatch:
    inputs:
      tag:
        description: '릴리즈 태그 (예: v1.2.3)'
        required: true
        type: string

jobs:
  create-release-pr:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    env:
      TAG: ${{ github.event.inputs.tag }}
      BRANCH: release/${{ github.event.inputs.tag }}

    steps:
      - name: Checkout develop branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: develop

      - name: Configure Git
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"

      - name: Create release branch from develop
        run: |
          git checkout develop
          git checkout -b "$BRANCH"
          git push origin "$BRANCH"

      - name: Install GitHub CLI
        uses: cli/cli-action@v1

      - name: Create Pull Request (develop → ${{ env.BRANCH }})
        run: |
          gh pr create \
            --title "chore(release): $TAG 준비" \
            --body "자동 생성된 릴리즈 PR입니다.\n\n- 태그: $TAG\n- 브랜치: $BRANCH" \
            --base "$BRANCH" \
            --head "develop"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
