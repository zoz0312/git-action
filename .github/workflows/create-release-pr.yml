name: Create release branch and PR

on:
  workflow_dispatch:
    inputs:
      tag:
        description: '릴리즈 태그 (예: v1.2.3)'
        required: true
        type: string

jobs:
  create-release-pr:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    env:
      TAG: ${{ github.event.inputs.tag }}
      BRANCH: release/${{ github.event.inputs.tag }}

    steps:
      - name: Checkout repo with full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: develop

      - name: Configure Git identity
        run: |
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"

      - name: Ensure develop branch and create release branch
        run: |
          git checkout develop
          git checkout -b "$BRANCH"
          git push origin "$BRANCH"

      - name: Create Pull Request (develop → ${{ env.BRANCH }})
        uses: octokit/request-action@v2.x
        with:
          route: POST /repos/${{ github.repository }}/pulls
          parameters: |
            {
              "title": "chore(release): ${{ env.TAG }} 준비",
              "head": "develop",
              "base": "${{ env.BRANCH }}",
              "body": "자동 생성된 릴리즈 PR입니다.\\n\\n- 태그: ${{ env.TAG }}\\n- 브랜치: ${{ env.BRANCH }}",
              "draft": false
            }
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
